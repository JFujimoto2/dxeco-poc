# SaaS管理ツール POC 開発計画

---

## 0. POCの目的

| 項目 | 内容 |
| --- | --- |
| ゴール | 自社開発で現場課題を解決できることを実証し、DXECO導入（年204万円）の代替判断材料とする |
| デモ対象 | バルくん・現場管理者（先行導入部署） |
| 開発者 | 1名（自分） |
| 技術スタック | Rails 8 + PostgreSQL + Entra ID認証 |
| 開発支援 | AI（Claude等）活用で高速開発 |

## 1. POCで証明すべきこと

現場ヒアリングで判明した最重要課題に対して、自社開発で解決できることを示す。

| # | 証明すべきこと | DXECOとの差別化ポイント |
| --- | --- | --- |
| 1 | **アンケート（棚卸し・PW更新）が動く** | DXECOと同等。年200万円払わなくても作れる |
| 2 | **入退社タスク管理が動く** | DXECOと同等（チェックリスト＋プリセット） |
| 3 | **申請→承認フローが動く** | **DXECOにない機能**（製品資料で未確認） |
| 4 | **Entra ID連携で退職者を自動検出できる** | **DXECOにない機能**（台帳と検知が連動） |
| 5 | **260件のSaaSを手動登録・管理できる** | DXECOと同等だが、カスタマイズ自由 |
| 6 | **セキュリティ（IP制限・監査ログ）が標準装備** | DXECOは有料オプション（年24万円追加） |

## 2. POCスコープ（やること / やらないこと）

### やること（POC範囲）

| 機能 | 理由 |
| --- | --- |
| Entra ID SSO認証 | 技術基盤。これが動かないと始まらない |
| SaaS台帳CRUD | コア機能。260件登録できるUIを見せる |
| アカウント管理（手動登録＋CSV取込） | コア機能。メンバー×SaaSマトリクス |
| アカウントサーベイ（棚卸しアンケート） | **現場が最も求めている機能** |
| 入退社タスク管理（チェックリスト） | **現場が最も求めている機能** |
| SaaS利用申請・承認フロー | **DXECOにない差別化機能** |
| 退職者アカウント検出（Entra ID連携） | **DXECOにない差別化機能** |
| IP制限・操作ログ | セキュリティ（DXECOは有料オプション） |

### やらないこと（POC範囲外 → 本番移行時に対応）

| 機能 | 理由 |
| --- | --- |
| SaaSアカウント自動同期（各SaaS API連携） | 260件の大半がAPI不可。後回しで問題ない |
| シャドーIT検知 | ブラウザ拡張が必要。POCには不要 |
| コストダッシュボード（グラフ） | 台帳にコスト情報を持てば十分。可視化は後回し |
| IT資産管理（PC・携帯） | SaaS管理が軌道に乗ってから拡張 |
| Terraform IaC | POCはシンプルデプロイ。本番移行時にコード化 |
| メール通知 | POCはTeams通知のみ。メールは本番で追加 |

## 3. 開発タスク

### フェーズ1: 基盤構築（2日）

| # | タスク | 内容 | 見積もり |
| --- | --- | --- | --- |
| 1 | Rails新規プロジェクト | Rails 8 + PostgreSQL + 基本レイアウト | 0.5日 |
| 2 | Entra ID SSO認証 | OmniAuth + Graph API連携、usersテーブル、ログイン/ログアウト | 1日 |
| 3 | 権限管理 | admin/manager/viewer ロール、IPアドレス制限 | 0.5日 |

### フェーズ2: コア台帳機能（3日）

| # | タスク | 内容 | 見積もり |
| --- | --- | --- | --- |
| 4 | SaaS台帳CRUD | 登録・編集・一覧・詳細・検索・フィルタ。カスタムフィールド | 1日 |
| 5 | 契約情報管理 | プラン・金額・更新日・担当者。契約更新アラート用データ | 0.5日 |
| 6 | アカウント管理 | SaaS別アカウント登録・CSV取込・メンバー×SaaSマトリクス表示 | 1日 |
| 7 | メンバー管理 | Entra ID同期結果の表示、本部・部門での絞り込み | 0.5日 |

### フェーズ3: 差別化機能（5日）★POCの核心

| # | タスク | 内容 | 見積もり |
| --- | --- | --- | --- |
| 8 | **アカウントサーベイ** | 配信→回答→集計→台帳反映。未回答者リマインド | 2日 |
| 9 | **入退社タスク管理** | プリセット→タスク自動生成→担当者割当→ステータス管理 | 1日 |
| 10 | **SaaS利用申請・承認フロー** | 申請→承認→台帳反映。承認待ち一覧ダッシュボード | 1.5日 |
| 11 | **退職者アカウント検出** | Entra ID同期（accountEnabled=false）→残存アカウント検出→一覧表示 | 0.5日 |

### フェーズ4: 通知・仕上げ（2日）

| # | タスク | 内容 | 見積もり |
| --- | --- | --- | --- |
| 12 | Teams通知 | Power Automate Workflows Webhook、Adaptive Card | 0.5日 |
| 13 | 操作ログ | 変更履歴の記録・表示（監査対応） | 0.5日 |
| 14 | デモデータ投入 | 現場の実データに近いサンプルデータ（SaaS 30件程度） | 0.5日 |
| 15 | デプロイ | Azure App Service（Basic B1）にデプロイ | 0.5日 |

### スケジュール

| フェーズ | 期間 | 成果物 |
| --- | --- | --- |
| フェーズ1: 基盤 | 2日 | Entra IDログインが動く状態 |
| フェーズ2: 台帳 | 3日 | SaaS・アカウント・メンバーの台帳が動く |
| フェーズ3: 差別化 | 5日 | **サーベイ・タスク管理・申請承認・退職者検出が動く** |
| フェーズ4: 仕上げ | 2日 | Teams通知、デモ環境にデプロイ完了 |
| **合計** | **約2週間** | **デモ可能なPOC** |

## 4. DB設計（POCスコープ）

### テーブル一覧

| テーブル | 用途 |
| --- | --- |
| users | メンバー情報（Entra ID同期） |
| saases | SaaS台帳 |
| saas_contracts | 契約情報 |
| saas_accounts | アカウント情報（メンバー×SaaS） |
| surveys | アカウントサーベイ（棚卸し・PW更新） |
| survey_responses | サーベイ回答 |
| task_presets | 入退社タスクプリセット |
| task_preset_items | プリセット内のタスク項目 |
| tasks | 入退社タスク（生成されたチェックリスト） |
| task_items | タスク内の個別アクション |
| approval_requests | SaaS利用申請 |
| approval_steps | 承認ステップ（多段階承認対応） |
| audit_logs | 操作ログ |

### 主要テーブル定義

#### users
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| entra_id_sub | string | Entra IDのsub（一意キー） |
| email | string | メールアドレス |
| display_name | string | 表示名 |
| department | string | 部門 |
| job_title | string | 役職 |
| employee_id | string | 社員番号 |
| account_enabled | boolean | Entra IDアカウント状態（退職検出用） |
| role | string | admin / manager / viewer |
| last_signed_in_at | datetime | 最終ログイン日時 |

#### saases
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| name | string | SaaS名 |
| category | string | カテゴリ |
| url | string | サービスURL |
| admin_url | string | 管理画面URL |
| description | text | 概要 |
| owner_id | bigint | 契約担当者（FK→users） |
| status | string | active / trial / cancelled |
| custom_fields | jsonb | カスタムフィールド |

#### saas_accounts
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| saas_id | bigint | FK→saases |
| user_id | bigint | FK→users |
| account_email | string | SaaS側のアカウントメール |
| status | string | active / suspended / deleted |
| last_login_at | datetime | 最終ログイン日（API取得 or 手動） |
| notes | text | 備考 |

#### surveys（サーベイ）
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| title | string | サーベイタイトル |
| survey_type | string | account_review / password_update |
| created_by_id | bigint | FK→users（作成者） |
| status | string | draft / active / closed |
| sent_at | datetime | 配信日時 |
| deadline | datetime | 回答期限 |

#### survey_responses（サーベイ回答）
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| survey_id | bigint | FK→surveys |
| user_id | bigint | FK→users（回答者） |
| saas_account_id | bigint | FK→saas_accounts |
| response | string | using / not_using / updated（回答） |
| responded_at | datetime | 回答日時 |
| notes | text | 備考 |

#### tasks（入退社タスク）
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| title | string | タスクタイトル（例: 山田太郎の退職処理） |
| task_type | string | onboarding / offboarding / transfer |
| target_user_id | bigint | FK→users（対象者） |
| created_by_id | bigint | FK→users（作成者） |
| status | string | open / in_progress / completed |
| due_date | date | 期限 |

#### task_items（タスク内アクション）
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| task_id | bigint | FK→tasks |
| action_type | string | account_create / account_delete / pc_return等 |
| description | string | タスク内容 |
| saas_id | bigint | FK→saases（対象SaaS） |
| assignee_id | bigint | FK→users（担当者） |
| status | string | pending / completed |
| completed_at | datetime | 完了日時 |
| notes | text | メモ |

#### approval_requests（SaaS利用申請）
| カラム | 型 | 説明 |
| --- | --- | --- |
| id | bigint | PK |
| request_type | string | new_saas / add_account / remove_account |
| requester_id | bigint | FK→users（申請者） |
| saas_id | bigint | FK→saases（既存SaaSの場合） |
| saas_name | string | 新規SaaSの場合のSaaS名 |
| reason | text | 利用理由 |
| status | string | pending / approved / rejected |
| approved_by_id | bigint | FK→users（承認者） |
| approved_at | datetime | 承認日時 |
| rejection_reason | text | 却下理由 |

## 5. 機能詳細（POCスコープ）

### 5.1 アカウントサーベイ

**画面構成:**
1. サーベイ作成画面（管理者用）：対象SaaS選択、対象メンバー選択（部門で一括選択可）、期限設定
2. サーベイ回答画面（メンバー用）：自分に紐づくSaaSアカウント一覧 → 各SaaSに「利用中 / 利用していない」を回答
3. サーベイ結果画面（管理者用）：回答状況一覧、未回答者一覧、「利用していない」回答の一覧

**フロー:**
```
管理者がサーベイ作成
  ↓ 対象メンバーにTeams通知（回答URLリンク付き）
メンバーが回答画面でSaaS利用状況を回答
  ↓ 3日後・7日後に未回答者にリマインド通知
管理者が結果を確認
  ↓ 「利用していない」→ アカウント台帳に「削除候補」フラグ
```

### 5.2 入退社タスク管理

**画面構成:**
1. プリセット管理画面：入社・退職・異動ごとのテンプレート定義
2. タスク生成画面：対象者を選択 → プリセットからチェックリスト自動生成（対象者が持つSaaSアカウントを自動列挙）
3. タスク一覧画面：未完了タスク一覧、担当者別・期限別フィルタ
4. タスク詳細画面：各アクションの完了/未完了チェック、メモ

**退職タスク自動生成の例:**
```
対象者: 山田太郎（退職日: 2026/3/31）
  ↓ 山田太郎が持つSaaSアカウントを台帳から自動取得
  ↓ プリセット「退職処理」のテンプレートと合わせてタスク生成

生成されるタスク:
  □ Google Workspace アカウント削除（担当: 鈴木）
  □ Slack アカウント削除（担当: 鈴木）
  □ SUUMO管理画面 アカウント削除（担当: 佐藤）
  □ 楽待 アカウント削除（担当: 佐藤）
  □ PC返却（担当: 田中）
  □ 社用携帯返却（担当: 田中）
  □ 機密保持契約締結（担当: 人事）
```

### 5.3 SaaS利用申請・承認フロー

**画面構成:**
1. 申請フォーム：SaaS名・用途・利用人数・費用概算・セキュリティ要件
2. 承認待ち一覧（承認者用）：承認/却下ボタン、コメント入力
3. 申請履歴（申請者用）：自分の申請のステータス確認
4. 管理画面（admin用）：全申請の一覧、ステータスフィルタ

**フロー:**
```
申請者が申請フォームから申請
  ↓ 承認者（上長 or 情シス）にTeams通知
承認者が承認/却下
  ↓ 承認の場合: 申請者に通知 + SaaS台帳への登録を促す（or 自動登録）
  ↓ 却下の場合: 申請者に理由付きで通知
```

### 5.4 退職者アカウント検出

**処理フロー:**
```
管理画面から「Entra ID同期」ボタンを押す
  ↓ Graph APIで全ユーザー取得 → usersテーブル更新
  ↓ accountEnabled = false のユーザーを特定
  ↓ そのユーザーが持つ saas_accounts（status=active）を抽出
  ↓ 「退職者残存アカウント」一覧を画面表示
  ↓ Teams通知（アカウント一覧 + 対応依頼）
```

## 6. デモシナリオ

POC完成後、以下のシナリオでデモを実施する。

| # | シナリオ | 操作 | 証明すること |
| --- | --- | --- | --- |
| 1 | Entra IDでログイン | ログインボタン → MSログイン → 自動でユーザー情報反映 | Entra ID連携が動く |
| 2 | SaaS台帳を確認 | 事前投入した30件のSaaSを一覧・検索・フィルタ | 台帳管理の基本動作 |
| 3 | 棚卸しアンケートを配信 | サーベイ作成 → メンバーに配信 → 回答 → 結果確認 | **アンケート機能（DXECOと同等）** |
| 4 | 退職者のアカウントを検出 | Entra ID同期 → 退職者の残存アカウント一覧を表示 | **Entra ID連携（DXECOにない）** |
| 5 | 退職処理タスクを生成 | 退職者を選択 → チェックリスト自動生成 → 各担当者に割当 | **タスク管理（DXECOと同等）** |
| 6 | SaaS利用申請を出す | 申請フォーム入力 → 承認者が承認 → 台帳に反映 | **承認フロー（DXECOにない）** |
| 7 | 操作ログを確認 | 管理画面で変更履歴を表示 | **監査ログ（DXECOは有料）** |

---

作成日: 2026年2月10日
