# 社内開発 セキュリティガイドライン（案）

---

## 1. 目的

本ガイドラインは、社内で開発・運用するWebアプリケーションおよびローコードツールにおけるセキュリティ基準を定める。個人情報・業務データを安全に扱い、情報漏洩・不正アクセスを防止することを目的とする。

---

## 2. 適用範囲

社内で開発・運用する全てのツール・アプリケーションに適用する。取り扱うデータの機密性に応じて、必要な対策レベルが異なる。

| データ分類 | 例 | 対策レベル |
|-----------|-----|----------|
| 機密 | 個人情報（氏名・メール・社員番号）、契約金額、認証情報 | 高 |
| 社内限定 | 業務データ、社内連絡、設定情報 | 中 |
| 公開可 | 公開済みの情報、一般的な設定値 | 低 |

---

## 3. 認証・認可

### 3.1 認証

| 項目 | 基準 |
|------|------|
| 認証方式 | Microsoft Entra ID（SSO / OIDC）を第一選択とする |
| パスワード認証 | SSO非対応の場合のみ許可。その場合はMFA必須 |
| セッション管理 | サーバーサイドで管理。セッションIDをURLに含めない |
| ログイン試行制限 | 連続失敗時のアカウントロック or 遅延を実装 |

### 3.2 認可

| 項目 | 基準 |
|------|------|
| 最小権限原則 | ユーザーには必要最小限の権限のみ付与する |
| ロールベースアクセス制御 | 権限をロール単位で管理する（個別ユーザーへの直接付与は避ける） |
| デフォルト権限 | 新規ユーザーは最低権限（閲覧のみ等）で作成する |
| 管理者操作の制限 | 管理者専用機能はサーバーサイドで権限チェックを行う |

---

## 4. 通信の暗号化

| 区間 | 基準 |
|------|------|
| ユーザー ↔ アプリケーション | HTTPS必須（HTTP接続は自動リダイレクト） |
| アプリケーション ↔ データベース | SSL/TLS接続必須 |
| アプリケーション ↔ 外部API | HTTPS必須 |
| SSL証明書 | マネージド証明書（Azure等）を利用し、手動管理を避ける |

---

## 5. アプリケーションセキュリティ

### 5.1 フルコード開発（必須対策）

| 脅威 | 対策 | 確認方法 |
|------|------|---------|
| SQLインジェクション | ORMのパラメータ化クエリを使用。生SQLを避ける | Brakeman |
| XSS | テンプレートエンジンの自動エスケープを使用。`html_safe`の使用を最小限に | Brakeman |
| CSRF | フレームワーク標準のCSRFトークンを有効化 | Brakeman |
| マスアサインメント | Strong Parameters等でパラメータを明示的に制限 | Brakeman |
| ディレクトリトラバーサル | ユーザー入力をファイルパスに直接使用しない | Brakeman |
| セキュリティヘッダー | X-Frame-Options、X-Content-Type-Options等を設定 | フレームワーク標準 |

### 5.2 依存関係の管理

| 項目 | 基準 |
|------|------|
| 脆弱性チェック | CI毎回実行（bundler-audit / npm audit等） |
| 自動更新PR | Dependabot等で依存パッケージの更新を自動検知 |
| パッチ適用 | セキュリティパッチは1週間以内に適用を検討 |

### 5.3 ローコード開発

| 項目 | 基準 |
|------|------|
| コネクタ制限 | DLPポリシーで業務用と個人用のコネクタを分離 |
| 共有範囲 | フローの共有は必要最小限のメンバーに限定 |
| 外部接続 | 外部サービスへの接続はサービスアカウントを使用 |

---

## 6. インフラセキュリティ

### 6.1 ネットワーク

| 項目 | 基準 |
|------|------|
| アクセス制限 | 社内IP制限 or VPN経由のアクセスに限定（社内ツールの場合） |
| データベース | パブリックアクセス無効。アプリケーションからの接続のみ許可 |
| コンテナレジストリ | プライベートレジストリを使用 |

### 6.2 実行環境

| 項目 | 基準 |
|------|------|
| コンテナ実行ユーザー | non-root（root権限で実行しない） |
| 環境変数 | 秘密情報はコンテナの環境変数またはKey Vaultで管理 |
| イメージタグ | Git SHAでイミュータブルタグ付け（`latest`タグの本番利用禁止） |

### 6.3 バックアップ

| 対象 | 方式 | 保持期間 |
|------|------|---------|
| データベース | マネージドサービスの自動バックアップ | 7日間以上 |
| ソースコード | GitHubリポジトリ | 無期限 |
| インフラ設定 | IaCコード or 手順書 | 無期限 |

---

## 7. 秘密情報の管理

### 7.1 管理方針

| 環境 | 管理方法 |
|------|---------|
| 開発環境 | `.env` ファイル（`.gitignore`に登録必須） |
| CI環境 | GitHub Secrets |
| 本番環境 | Azure Container Apps環境変数 or Key Vault |

### 7.2 禁止事項

| 禁止事項 | 理由 |
|---------|------|
| ソースコードへの秘密情報のハードコード | 漏洩リスク。Brakemanで検出 |
| Slack・メール・チャットでの秘密情報の共有 | 平文での送信は漏洩リスク |
| `.env`ファイルのGitコミット | リポジトリ経由での漏洩防止 |
| 共有アカウントの使用 | 操作の追跡が不可能になる |

### 7.3 シークレットのローテーション

| 対象 | 頻度 | 方法 |
|------|------|------|
| Entra IDクライアントシークレット | 最大24ヶ月（期限2ヶ月前に更新） | 新シークレット発行 → 切替 → 旧シークレット削除 |
| データベースパスワード | 年次 | パスワード変更 → 接続文字列更新 → 動作確認 |
| APIキー・トークン | 年次確認 | 必要に応じてローテーション |

---

## 8. 監査・ログ

### 8.1 アプリケーションログ

| 項目 | 基準 |
|------|------|
| 操作ログ | 個人情報を扱うデータの作成・更新・削除を自動記録 |
| 記録内容 | 操作者、操作種別、対象リソース、変更前後の差分、IPアドレス、日時 |
| ログの保持 | 最低1年間 |
| アクセス制限 | 操作ログの閲覧は管理者に限定 |

### 8.2 ログに記録してはいけない情報

| 禁止 | 理由 |
|------|------|
| パスワード・トークン | 漏洩リスク |
| クレジットカード番号 | PCI DSS違反 |
| パスワードリセットURL | セッションハイジャック防止 |

---

## 9. エラー監視・障害対応

### 9.1 エラー監視

| 項目 | 基準 |
|------|------|
| アプリケーションエラー | 即時通知（Teams等） |
| 重複抑制 | 同一エラーの連続通知を抑制（例: 5分間に1回） |
| インフラ障害 | Azure Monitor等でコンテナ再起動・リソース異常を検知 |

### 9.2 障害対応

| 障害レベル | 対応時間 | 例 |
|-----------|---------|-----|
| 緊急 | 当日中 | セキュリティ脆弱性の発見、データ漏洩の疑い |
| 高 | 翌営業日 | アプリケーションの停止、主要機能の障害 |
| 中 | 1週間以内 | 一部機能の不具合、パフォーマンス低下 |
| 低 | 次回リリース | UI改善、軽微な不具合 |

---

## 10. CI/CDセキュリティ

| 項目 | 基準 |
|------|------|
| 認証方式 | Service Principal + OIDC（シークレットレスが望ましい） |
| ブランチ保護 | main / prodブランチへの直接push禁止、PR必須 |
| CIチェック | セキュリティスキャン（Brakeman等）をマージ条件に含める |
| デプロイ権限 | 本番デプロイはprodブランチへのマージ時のみ自動実行 |
| コンテナイメージ | プライベートレジストリからのみプル |

---

## 11. 個人情報の取り扱い

### 11.1 取り扱いルール

| 項目 | 基準 |
|------|------|
| 収集 | 業務に必要な最小限の個人情報のみ収集する |
| 保管 | 暗号化されたデータベースに保管。ローカルファイルでの保管禁止 |
| アクセス | 業務上必要な担当者のみアクセス可能（ロールで制御） |
| 削除 | 不要になった個人情報は速やかに削除する |
| 外部送信 | 個人情報を含むデータの外部送信は原則禁止。必要な場合は課長承認 |

### 11.2 AIツールへの入力制限

**会社が管理するアカウントでの利用のみ認める。** 個人アカウントでの業務利用は禁止。詳細は「社内開発ガイドライン」のAI利用ガイドラインを参照。

| 入力可 | 入力禁止 |
|--------|---------|
| 技術的な質問・相談 | 個人の氏名・メールアドレス・社員番号 |
| 汎用的なコード生成依頼 | 実際の業務データ・本番データ |
| 設計パターンの相談 | パスワード・APIキー・接続文字列 |
| ドキュメントの文章作成 | 社外秘の経営情報・顧客情報 |
| サンプルデータでの動作確認 | 社内システムのIPアドレス・ネットワーク構成 |

**誤って禁止情報を入力した場合:** 速やかに上長に報告し、該当する会話を削除する。必要に応じてパスワード・APIキーの変更を実施する。

---

## 12. セキュリティチェックリスト

新規ツールのリリース前に以下を確認する。

### 12.1 フルコード開発

- [ ] Entra ID SSO（またはMFA付き認証）が実装されている
- [ ] ロールベースのアクセス制御が実装されている
- [ ] 全通信がHTTPSで暗号化されている
- [ ] DB接続がSSLで暗号化されている
- [ ] Brakemanの警告が0件である
- [ ] 依存パッケージの既知脆弱性が0件である（bundler-audit / npm audit）
- [ ] CSRFトークンが有効化されている
- [ ] 秘密情報がソースコードに含まれていない
- [ ] 操作ログが実装されている（個人情報を扱う場合）
- [ ] エラー監視・通知が設定されている
- [ ] バックアップが設定されている
- [ ] ドキュメント（機能概要、運用手順、セキュリティ対策）が整備されている
- [ ] 2名以上の保守体制が確保されている

### 12.2 ローコード開発

- [ ] フローの所有者が2名以上設定されている
- [ ] 共有範囲が必要最小限に設定されている
- [ ] 外部サービスへの接続が共有アカウントでない
- [ ] 個人情報の取り扱いがある場合、アクセス制限が設定されている
- [ ] 動作確認の記録がある
- [ ] ドキュメント（機能概要、運用手順）が整備されている

---

## 13. 今後の検討事項

| 対策 | 内容 | 優先度 |
|------|------|--------|
| Azure Key Vault | 秘密情報の集中管理 | 中 |
| VNet統合 | アプリケーションとDBをVNet内に閉じる | 高 |
| WAF | Azure Front Door + WAFによるアプリケーション層防御 | 中 |
| 脆弱性診断 | 外部ペネトレーションテスト | 全社展開前 |
| セッションタイムアウト | 無操作時の自動ログアウト | 中 |
| 条件付きアクセスポリシー | Entra IDでMFA強制、社外アクセス制限 | 中 |

---

作成日: 2026年2月16日