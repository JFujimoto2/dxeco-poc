# SaaS管理ツール 機能概要

## システム概要

社内で利用する約260件のSaaSのアカウント・契約・コストを一元管理するWebアプリケーション。
DXECO（年204万円）の代替として自社開発し、現場の運用課題を解決する。

**技術スタック:** Ruby on Rails 8 / PostgreSQL / Bootstrap 5 / Microsoft Entra ID (SSO) / Hotwire

---

## 機能マップ

```
┌─────────────────────────────────────────────────────────────────┐
│                        ダッシュボード                              │
│  KPI概況 │ 承認待ち │ タスク進捗 │ 契約更新 │ コスト │ PW期限     │
└─────────────────────────────────────────────────────────────────┘
     │
     ├── 台帳管理 ──────────────────────────────────────────────
     │   ├── SaaS台帳（CRUD / 検索 / フィルタ / CSV入出力）
     │   ├── アカウント管理（ユーザー×SaaSマッピング / CSV入出力）
     │   ├── メンバー管理（Entra ID同期 / 部署・ロール管理）
     │   └── 契約情報（プラン / 金額 / 更新日 / 担当者）
     │
     ├── 業務プロセス ──────────────────────────────────────────
     │   ├── サーベイ（棚卸し / PW更新 / 配信・回答・集計）
     │   ├── タスク管理（入退社・異動 / プリセット / チェックリスト）
     │   └── 申請・承認（SaaS追加 / アカウント追加・削除）
     │
     ├── Entra ID連携 ──────────────────────────────────────────
     │   ├── SSO認証（OIDC）
     │   ├── ユーザー同期（全体 or グループ指定）
     │   ├── SaaSアカウント同期（エンタープライズアプリ経由）
     │   └── 退職者アカウント検出（accountEnabled連動）
     │
     ├── 通知 ──────────────────────────────────────────────────
     │   ├── Teams通知（3チャンネル: 一般 / サーベイ / エラー）
     │   ├── メール通知（タスク / 承認 / サーベイ）
     │   └── 契約更新アラート（30日/7日前 + 期限切れ）
     │
     └── セキュリティ・運用 ────────────────────────────────────
         ├── 操作ログ（全変更の自動記録 / 差分表示 / CSV出力）
         ├── エラー監視（Teams通知 + Azure Monitor）
         └── バッチ管理（手動実行 / 実行履歴）
```

---

## 各機能の詳細

### 1. ダッシュボード

ログイン後の最初の画面。システム全体の状況を一目で把握できる。

| 表示項目 | 内容 |
| --- | --- |
| KPIカード | SaaS件数、メンバー数、アカウント数 |
| 承認待ち | 未処理の申請一覧（admin/manager向け） |
| タスク進捗 | アクティブなタスクの完了率 |
| 契約更新アラート | 30日以内に期限が来る契約 |
| コスト概況 | 月額/年額合計 + カテゴリ別ドーナツチャート |
| PW期限アラート | パスワード有効期限切れ/期限間近のユーザー |
| 操作ログ | 直近の変更履歴（admin専用） |

### 2. SaaS台帳

全SaaSの基本情報と契約情報を管理する中央台帳。

- **基本情報:** SaaS名、カテゴリ、URL、管理画面URL、説明、ステータス
- **契約情報:** プラン名、月額/年額費用、契約開始日・終了日、自動更新有無、担当者
- **検索・フィルタ:** キーワード検索、カテゴリフィルタ、ステータスフィルタ
- **CSV入出力:** テンプレートDL → 一括登録、フィルタ条件付きCSVエクスポート
- **Entra ID連携:** エンタープライズアプリのオブジェクトIDを紐付けてアカウント自動同期

### 3. アカウント管理

「誰がどのSaaSを使っているか」を管理。

- **登録方法:** 手動登録、CSV一括取込、Entra IDエンタープライズアプリからの自動同期
- **管理項目:** SaaS名、ユーザー、アカウントメール、ロール、ステータス（active/suspended/deleted）
- **フィルタ:** SaaS別、ユーザー別、ステータス別
- **CSV入出力:** 一括登録テンプレート、フィルタ付きエクスポート

### 4. メンバー管理

社内ユーザー情報の管理。Entra IDから自動同期される。

- **同期情報:** 氏名、メール、部署、役職、社員番号、アカウント有効/無効
- **グループベース同期:** `ENTRA_SYNC_GROUP_ID` 設定時は指定グループのメンバーのみ同期
- **ロール管理:** admin（全権限）/ manager（編集権限）/ viewer（閲覧のみ）
- **SaaS保有状況:** 各メンバーが利用しているSaaSの一覧表示

### 5. サーベイ（アカウント棚卸し）

SaaS利用状況の定期的な確認・パスワード更新依頼に使用。

- **種類:** アカウント棚卸し（利用中/未利用）、パスワード更新確認
- **フロー:** 作成 → 配信（メール＋Teams通知）→ 回答 → 集計 → 結果確認
- **リマインド:** 未回答者への再通知（メール＋Teams）
- **タスク連携:** 「未利用」回答からワンクリックでアカウント削除タスクを自動生成

### 6. タスク管理

入社・退職・異動時のアカウント作成/削除作業をチェックリストで管理。

- **プリセット:** 入社用/退職用/異動用のテンプレートを事前定義
- **タスク生成:** 対象者を選択 → プリセットからチェックリスト自動生成（保有SaaSアカウントを自動列挙）
- **管理:** 担当者割当、期限設定、進捗率表示、完了チェック
- **通知:** 担当者へのメール＋Teams通知

### 7. 申請・承認ワークフロー

SaaSの新規利用やアカウントの追加/削除を申請・承認するフロー。

- **申請種別:** SaaS新規追加、アカウント追加、アカウント削除
- **フロー:** 申請 → 承認者にメール＋Teams通知 → 承認/却下 → 申請者に結果通知
- **管理画面:** 全申請一覧、ステータスフィルタ、承認待ち件数バッジ

### 8. バッチ管理

定期実行が必要な処理を管理者が手動実行する画面。

| バッチ | 内容 |
| --- | --- |
| Entra IDユーザー同期 | Graph APIからユーザー情報を取得・更新 → 退職者検出を自動実行 |
| 退職者アカウント検出 | Entra IDで無効化されたユーザーの残存SaaSアカウントを検出 → Teams通知 |
| 契約更新チェック | 30日以内に更新期限が来る契約を検出 → Teams通知 |
| SaaSアカウント同期 | Entra IDエンタープライズアプリからSSO連携済みアカウントを同期 |

全バッチの実行履歴（日時、ステータス、処理件数、エラー件数、実行時間）を記録・表示。

### 9. 操作ログ

全データ変更操作を自動記録する監査ログ。

- **記録対象:** SaaS台帳、アカウント、ユーザー等の主要モデルのCRUD操作
- **記録内容:** 操作者、操作種別、対象リソース、変更前後の差分（JSONB）、IPアドレス、日時
- **検索:** リソース種別、操作者、日付範囲でフィルタ
- **CSV出力:** フィルタ条件付きでエクスポート

### 10. 認証・認可

- **SSO:** Microsoft Entra ID (OIDC) によるシングルサインオン
- **開発環境:** `ENTRA_CLIENT_ID` 未設定時は開発用ログインフォーム
- **ロール:**
  - `admin` — 全機能にアクセス（バッチ実行、ロール変更、操作ログ等）
  - `manager` — データ編集、サーベイ作成、タスク管理、申請承認
  - `viewer` — 閲覧のみ、サーベイ回答

### 11. 通知

| チャネル | 対象イベント |
| --- | --- |
| Teams（一般） | タスク割当、承認リクエスト/結果、退職者検出、契約更新アラート |
| Teams（サーベイ） | サーベイ配信通知、未回答リマインド |
| Teams（エラー） | アプリケーションエラー、コンテナ再起動 |
| メール | タスク割当、承認通知、サーベイ配信・リマインド |

### 12. コスト可視化

- **ダッシュボード:** 月額合計 / 年額合計（万円単位）
- **カテゴリ別チャート:** Chart.js によるドーナツチャート（グループウェア、CRM、開発ツール等）
- **データソース:** SaaS台帳の契約情報（月額/年額）から自動集計

---

## ロール別アクセス権限

| 機能 | viewer | manager | admin |
| --- | --- | --- | --- |
| ダッシュボード閲覧 | o | o | o |
| SaaS台帳閲覧 | o | o | o |
| SaaS台帳編集 | - | o | o |
| アカウント管理 | o（閲覧） | o | o |
| メンバー閲覧 | o | o | o |
| サーベイ回答 | o | o | o |
| サーベイ作成・管理 | - | o | o |
| タスク管理 | - | o | o |
| 申請作成 | o | o | o |
| 申請承認 | - | o | o |
| バッチ実行 | - | - | o |
| ロール変更 | - | - | o |
| 操作ログ閲覧 | - | - | o |

---

作成日: 2026年2月15日
