<mxfile host="65bd71144e">
    <diagram id="infra" name="インフラ構成">
        <mxGraphModel dx="674" dy="619" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="SaaS管理ツール POC インフラ構成図" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="370" y="20" width="380" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="azure" value="Azure (japaneast)" style="points=[[0,0],[0.25,0],[0.5,0],[0.75,0],[1,0],[1,0.25],[1,0.5],[1,0.75],[1,1],[0.75,1],[0.5,1],[0.25,1],[0,1],[0,0.75],[0,0.5],[0,0.25]];outlineConnect=0;gradientColor=none;html=1;whiteSpace=wrap;fontSize=12;fontStyle=1;shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_region;verticalAlign=top;align=left;spacingLeft=30;fillColor=#E6F2FF;strokeColor=#0078D4;dashed=1;container=1;" parent="1" vertex="1">
                    <mxGeometry x="160" y="80" width="800" height="580" as="geometry"/>
                </mxCell>
                <mxCell id="rg" value="rg-dxceco-poc" style="points=[[0,0],[0.25,0],[0.5,0],[0.75,0],[1,0],[1,0.25],[1,0.5],[1,0.75],[1,1],[0.75,1],[0.5,1],[0.25,1],[0,1],[0,0.75],[0,0.5],[0,0.25]];outlineConnect=0;gradientColor=none;html=1;whiteSpace=wrap;fontSize=11;fontStyle=1;shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_vpc;verticalAlign=top;align=left;spacingLeft=30;fillColor=#F5F5F5;strokeColor=#666666;dashed=1;container=1;" parent="azure" vertex="1">
                    <mxGeometry x="30" y="40" width="740" height="520" as="geometry"/>
                </mxCell>
                <mxCell id="cae" value="Container Apps Environment&#xa;(cae-dxceco-poc)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;fontStyle=1;fontSize=11;container=1;" parent="rg" vertex="1">
                    <mxGeometry x="30" y="40" width="340" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="ssl_badge" value="Managed Certificate&#xa;(SSL/TLS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;fontSize=8;fontStyle=1;" parent="cae" vertex="1">
                    <mxGeometry x="105" y="5" width="130" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="app" value="Container App&#xa;(app-dxceco-poc)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;fontStyle=1;fontSize=10;container=1;" parent="cae" vertex="1">
                    <mxGeometry x="20" y="45" width="300" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="thruster" value="Thruster&#xa;(HTTP/2 proxy)&#xa;:3000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="app" vertex="1">
                    <mxGeometry x="15" y="30" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="puma" value="Puma&#xa;(Rails 8)&#xa;:3001" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="app" vertex="1">
                    <mxGeometry x="165" y="30" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="queue" value="Solid Queue&#xa;(Puma plugin)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="app" vertex="1">
                    <mxGeometry x="90" y="110" width="120" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="specs" value="0.5 vCPU / 1 GiB / non-root (uid 1000)&#xa;min 0 〜 max 1 replica" style="text;html=1;align=center;verticalAlign=middle;fontSize=8;fontColor=#666666;" parent="app" vertex="1">
                    <mxGeometry x="40" y="170" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e_thruster_puma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;" parent="app" source="thruster" target="puma" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="pg" value="Azure Database for PostgreSQL&#xa;Flexible Server&#xa;(psql-dxceco-poc)&#xa;&#xa;B1ms (1 vCore / 2 GiB)&#xa;&#xa;• dxceco_poc_production&#xa;• _production_cache&#xa;• _production_queue&#xa;• _production_cable" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;align=center;" parent="rg" vertex="1">
                    <mxGeometry x="440" y="40" width="220" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="pg_firewall" value="Firewall Rules&#xa;(IP制限)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;fontSize=8;fontStyle=1;" parent="rg" vertex="1">
                    <mxGeometry x="560" y="245" width="100" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="acr" value="Azure Container Registry&#xa;(acrdxcecopoc)&#xa;Basic / 10 GB" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="rg" vertex="1">
                    <mxGeometry x="440" y="330" width="220" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="monitor" value="Azure Monitor&#xa;(コンテナ再起動アラート)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#999999;fontSize=10;" parent="rg" vertex="1">
                    <mxGeometry x="30" y="380" width="170" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="e_app_pg" value="SSL" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=10;" parent="rg" source="cae" target="pg" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e_acr_app" value="image pull" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=9;dashed=1;" parent="rg" source="acr" target="cae" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="sec_note" value="セキュリティ:&#xa;• HTTPS強制 (Managed Certificate)&#xa;• DB接続: SSL必須&#xa;• PostgreSQL Firewall (IP制限)&#xa;• コンテナ: non-root (uid 1000)&#xa;• 環境変数で秘密情報管理&#xa;• Entra ID OIDC認証" style="text;html=1;align=left;verticalAlign=top;fontSize=8;fontColor=#28a745;fontStyle=2;" parent="rg" vertex="1">
                    <mxGeometry x="250" y="420" width="200" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="users" value="ユーザー" style="shape=actor;whiteSpace=wrap;html=1;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="40" y="240" width="60" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e_users_app" value="HTTPS" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=11;fontStyle=1;" parent="1" source="users" target="cae" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ext_group" value="外部サービス" style="text;html=1;align=center;verticalAlign=middle;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="1040" y="80" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="entra" value="Microsoft Entra ID&#xa;(アプリ登録 / Graph API)&#xa;OIDC認証 + ユーザー同期" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0078D4;fontColor=#FFFFFF;strokeColor=#005A9E;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1015" y="120" width="150" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="teams" value="Microsoft Teams&#xa;(Power Automate Webhook)&#xa;3チャンネル通知" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6264A7;fontColor=#FFFFFF;strokeColor=#464775;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1015" y="210" width="150" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="smtp" value="SMTP Server&#xa;(メール通知)&#xa;Action Mailer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF6F61;fontColor=#FFFFFF;strokeColor=#CC574D;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1015" y="300" width="150" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="e_app_entra" value="SSO (OIDC) / Graph API同期" style="fontSize=9;" parent="1" source="cae" target="entra" edge="1">
                    <mxGeometry x="0.5317" y="-8" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e_app_teams" value="Webhook通知&#xa;(一般/サーベイ/エラー)" style="fontSize=9;" parent="1" source="app" target="teams" edge="1">
                    <mxGeometry x="0.5591" y="3" relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="910" y="310"/>
                        </Array>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e_app_smtp" value="deliver_later&#xa;(Solid Queue)" style="fontSize=9;" parent="1" source="queue" target="smtp" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="710" y="415"/>
                            <mxPoint x="990" y="415"/>
                            <mxPoint x="990" y="335"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e_monitor_teams" value="アラート通知" style="fontSize=9;dashed=1;" parent="1" source="monitor" target="teams" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="980" y="535"/>
                            <mxPoint x="980" y="245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="cicd_group" value="CI/CD パイプライン" style="text;html=1;align=center;verticalAlign=middle;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="700" width="150" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="github_repo" value="GitHub Repository&#xa;(dxceco-poc)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#24292E;fontColor=#FFFFFF;strokeColor=#24292E;fontSize=10;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="740" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="ci_pipeline" value="CI (ci.yml)&#xa;main push / PR&#xa;──────────&#xa;Rubocop │ Brakeman&#xa;RSpec │ Playwright E2E" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3CD;strokeColor=#FFC107;fontSize=9;align=center;" parent="1" vertex="1">
                    <mxGeometry x="220" y="725" width="160" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="cd_pipeline" value="CD (deploy.yml)&#xa;prod push&#xa;──────────&#xa;Docker build → ACR push&#xa;→ Container Apps 更新" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D4EDDA;strokeColor=#28A745;fontSize=9;align=center;" parent="1" vertex="1">
                    <mxGeometry x="430" y="725" width="170" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="sp" value="Service Principal&#xa;(OIDC認証)&#xa;GitHub → Azure" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0078D4;fontColor=#FFFFFF;strokeColor=#005A9E;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="650" y="737" width="140" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="e_repo_ci" value="main push/PR" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=8;" parent="1" source="github_repo" target="ci_pipeline" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e_ci_cd" value="prod push" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=8;" parent="1" source="ci_pipeline" target="cd_pipeline" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e_cd_sp" value="OIDC" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=8;" parent="1" source="cd_pipeline" target="sp" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e_sp_acr" value="docker push&#xa;+ deploy" style="edgeStyle=orthogonalEdgeStyle;rounded=0;fontSize=8;dashed=1;" parent="1" source="sp" target="acr" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="branch_flow" value="feature → PR → main (CI) → PR → prod (CD) → Azure 自動デプロイ" style="text;html=1;align=left;verticalAlign=middle;fontSize=9;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="30" y="830" width="380" height="20" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>