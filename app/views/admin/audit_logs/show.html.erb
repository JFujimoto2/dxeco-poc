<% content_for(:page_title) { "操作ログ詳細" } %>

<div class="mb-4">
  <%= link_to admin_audit_logs_path, class: "btn btn-outline-secondary btn-sm" do %>
    <i class="bi bi-arrow-left me-1"></i>一覧に戻る
  <% end %>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">操作ログ #<%= @audit_log.id %></h5>
  </div>
  <div class="card-body">
    <table class="table table-borderless mb-0">
      <tr>
        <th style="width: 150px">日時</th>
        <td><%= @audit_log.created_at.strftime("%Y/%m/%d %H:%M:%S") %></td>
      </tr>
      <tr>
        <th>操作</th>
        <td>
          <% case @audit_log.action %>
          <% when "create" %>
            <span class="badge bg-success">作成</span>
          <% when "update" %>
            <span class="badge bg-primary">更新</span>
          <% when "destroy" %>
            <span class="badge bg-danger">削除</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <th>リソース</th>
        <td><%= @audit_log.resource_type %> #<%= @audit_log.resource_id %></td>
      </tr>
      <tr>
        <th>ユーザー</th>
        <td><%= @audit_log.user&.display_name || "システム" %></td>
      </tr>
      <tr>
        <th>IPアドレス</th>
        <td><%= @audit_log.ip_address || "-" %></td>
      </tr>
    </table>
  </div>
</div>

<% if @audit_log.changes_data.present? %>
  <div class="card">
    <div class="card-header">
      <h6 class="mb-0">変更内容</h6>
    </div>
    <div class="card-body p-0">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>項目</th>
            <th>変更前</th>
            <th>変更後</th>
          </tr>
        </thead>
        <tbody>
          <% @audit_log.changes_data.each do |key, values| %>
            <tr>
              <td><code><%= key %></code></td>
              <% if values.is_a?(Array) && values.size == 2 %>
                <td><span class="text-danger"><%= values[0] %></span></td>
                <td><span class="text-success"><%= values[1] %></span></td>
              <% else %>
                <td colspan="2"><%= values %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
